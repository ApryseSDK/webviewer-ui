"use strict";(self.webpackChunkwebviewer_ui=self.webpackChunkwebviewer_ui||[]).push([[9805],{"./src/components/ScaleOverlay/ScaleOverlayContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ScaleOverlay_ScaleOverlayContainer});var actions=__webpack_require__("./src/redux/actions/index.js"),react=__webpack_require__("./node_modules/react/index.js"),Button=__webpack_require__("./src/components/Button/index.js"),Icon=__webpack_require__("./src/components/Icon/index.js"),ScaleSelector=__webpack_require__("./src/components/ScaleOverlay/ScaleSelector.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),useFocusHandler=__webpack_require__("./src/hooks/useFocusHandler/index.js");function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _sliced_to_array(arr,i){return function _array_with_holes(arr){if(Array.isArray(arr))return arr}(arr)||function _iterable_to_array_limit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,i)||function _unsupported_iterable_to_array(o,minLen){if(!o)return;if("string"==typeof o)return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}(arr,i)||function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var propTypes={scales:prop_types_default().arrayOf(prop_types_default().object).isRequired,selectedScales:prop_types_default().arrayOf(prop_types_default().string).isRequired,onScaleSelected:prop_types_default().func.isRequired,onAddingNewScale:prop_types_default().func.isRequired},ScaleHeader=function(param){var scales=param.scales,selectedScales=param.selectedScales,onScaleSelected=param.onScaleSelected,onAddingNewScale=param.onAddingNewScale,t=_sliced_to_array((0,useTranslation.B)(),1)[0],onClickFocusWrapped=(0,useFocusHandler.A)(onAddingNewScale);return react.createElement("div",{className:"scale-overlay-header"},react.createElement(Icon.A,{glyph:"ic-calibrate",className:"scale-overlay-icon"}),react.createElement("h4",{id:"scale-dropdown-label",className:"scale-overlay-title"},t("option.measurementOption.scale")),scales.length?react.createElement(ScaleSelector.A,{scales,selectedScales,onScaleSelected,onAddingNewScale,ariaLabelledBy:"scale-dropdown-label"}):react.createElement(Button.A,{className:"add-new-scale",onClick:onClickFocusWrapped,dataElement:"addNewScale",label:t("option.measurement.scaleOverlay.addNewScale")}))};ScaleHeader.propTypes=propTypes;const ScaleOverlay_ScaleHeader=ScaleHeader;ScaleHeader.__docgenInfo={description:"",methods:[],displayName:"ScaleHeader",props:{scales:{description:"",type:{name:"arrayOf",value:{name:"object"}},required:!0},selectedScales:{description:"",type:{name:"arrayOf",value:{name:"string"}},required:!0},onScaleSelected:{description:"",type:{name:"func"},required:!0},onAddingNewScale:{description:"",type:{name:"func"},required:!0}}};var core=__webpack_require__("./src/core/index.js"),MeasurementDetail=__webpack_require__("./src/components/ScaleOverlay/MeasurementDetail.js"),selectors=__webpack_require__("./src/redux/selectors/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js");function CalibrationOverlay_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function CalibrationOverlay_sliced_to_array(arr,i){return function CalibrationOverlay_array_with_holes(arr){if(Array.isArray(arr))return arr}(arr)||function CalibrationOverlay_iterable_to_array_limit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,i)||function CalibrationOverlay_unsupported_iterable_to_array(o,minLen){if(!o)return;if("string"==typeof o)return CalibrationOverlay_array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CalibrationOverlay_array_like_to_array(o,minLen)}(arr,i)||function CalibrationOverlay_non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Scale=window.Core.Scale,CalibrationOverlayPropTypes={tempScale:prop_types_default().string,onCancelCalibrationMode:prop_types_default().func,onApplyCalibration:prop_types_default().func},CalibrationOverlay=function(param){var _worldScale,tempScale=param.tempScale,onCancelCalibrationMode=param.onCancelCalibrationMode,onApplyCalibration=param.onApplyCalibration,t=CalibrationOverlay_sliced_to_array((0,useTranslation.B)(),1)[0],isCalibrationPopupOpen=(0,es.d4)((function(state){return selectors.A.isElementOpen(state,"annotationPopup")})),canApplyCalibration=isCalibrationPopupOpen&&tempScale;return react.createElement("div",{className:"scale-overlay-calibrate"},react.createElement("div",{className:"scale-overlay-header"},react.createElement(Icon.A,{glyph:"ic-calibrate",className:"scale-overlay-icon"}),react.createElement("div",{className:"scale-overlay-title"},t("option.measurement.scaleModal.calibrate"))),react.createElement("div",{className:"scale-overlay-content"},t(canApplyCalibration?"option.measurement.scaleOverlay.inputKnowDimension":"option.measurement.scaleOverlay.selectTwoPoints")),react.createElement("div",{className:"divider"}),react.createElement("div",{className:"scale-overlay-footer"},react.createElement("button",{className:"calibration-cancel",onMouseDown:onCancelCalibrationMode},t("action.cancel")),react.createElement("button",{className:"calibration-apply",disabled:!(isCalibrationPopupOpen&&tempScale&&(null===(_worldScale=new Scale(tempScale).worldScale)||void 0===_worldScale?void 0:_worldScale.value)>0),"data-element":"calibrationApply",onMouseDown:onApplyCalibration,onTouchStart:onApplyCalibration},t("action.apply"))))};CalibrationOverlay.propTypes=CalibrationOverlayPropTypes;const ScaleOverlay_CalibrationOverlay=CalibrationOverlay;CalibrationOverlay.__docgenInfo={description:"",methods:[],displayName:"CalibrationOverlay",props:{tempScale:{description:"",type:{name:"string"},required:!1},onCancelCalibrationMode:{description:"",type:{name:"func"},required:!1},onApplyCalibration:{description:"",type:{name:"func"},required:!1}}};__webpack_require__("./src/components/ScaleOverlay/ScaleOverlay.scss");function ScaleOverlay_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ScaleOverlay_sliced_to_array(arr,i){return function ScaleOverlay_array_with_holes(arr){if(Array.isArray(arr))return arr}(arr)||function ScaleOverlay_iterable_to_array_limit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,i)||ScaleOverlay_unsupported_iterable_to_array(arr,i)||function ScaleOverlay_non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _to_consumable_array(arr){return function _array_without_holes(arr){if(Array.isArray(arr))return ScaleOverlay_array_like_to_array(arr)}(arr)||function _iterable_to_array(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||ScaleOverlay_unsupported_iterable_to_array(arr)||function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ScaleOverlay_unsupported_iterable_to_array(o,minLen){if(o){if("string"==typeof o)return ScaleOverlay_array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ScaleOverlay_array_like_to_array(o,minLen):void 0}}var ScaleOverlay_Scale=window.Core.Scale,ScaleOverlay_propTypes={annotations:prop_types_default().arrayOf(prop_types_default().object).isRequired,selectedTool:prop_types_default().object,updateIsCalibration:prop_types_default().func.isRequired,enableOrDisableToolElements:prop_types_default().func.isRequired,onScaleSelected:prop_types_default().func.isRequired,onCancelCalibrationMode:prop_types_default().func.isRequired,onApplyCalibration:prop_types_default().func.isRequired,onAddingNewScale:prop_types_default().func.isRequired},ScaleOverlay_ScaleOverlay=function(param){var annotations=param.annotations,selectedTool=param.selectedTool,updateIsCalibration=param.updateIsCalibration,enableOrDisableToolElements=param.enableOrDisableToolElements,onScaleSelected=param.onScaleSelected,onCancelCalibrationMode=param.onCancelCalibrationMode,onApplyCalibration=param.onApplyCalibration,onAddingNewScale=param.onAddingNewScale,forceUpdate=param.forceUpdate,_useSelector=ScaleOverlay_sliced_to_array((0,es.d4)((function(state){return[selectors.A.getCalibrationInfo(state),selectors.A.getActiveToolName(state)]}),es.bN),2),_useSelector_=_useSelector[0],isCalibration=_useSelector_.isCalibration,tempScale=_useSelector_.tempScale,_useSelector__previousToolName=_useSelector_.previousToolName,previousToolName=void 0===_useSelector__previousToolName?"AnnotationCreateDistanceMeasurement":_useSelector__previousToolName,isFractionalUnit=_useSelector_.isFractionalUnit,activeToolName=_useSelector[1],_useState=ScaleOverlay_sliced_to_array((0,react.useState)(core.A.getScales()),2),scales=_useState[0],setScales=_useState[1],shouldShowMeasurementDetail=!(!Object.keys(scales).length||!selectedTool&&(!annotations.length||annotations.length>1));(0,react.useEffect)((function(){forceUpdate()}),[scales]),(0,react.useEffect)((function(){var onScaleUpdated=function(newScales){setScales(newScales)},updateScales=function(){setScales(core.A.getScales())},onCreateAnnotationWithNoScale=function(){onAddingNewScale()};return core.A.addEventListener("scaleUpdated",onScaleUpdated),core.A.addEventListener("createAnnotationWithNoScale",onCreateAnnotationWithNoScale),core.A.addEventListener("annotationsLoaded",updateScales),core.A.addEventListener("annotationChanged",updateScales),function(){core.A.removeEventListener("scaleUpdated",onScaleUpdated),core.A.removeEventListener("createAnnotationWithNoScale",onCreateAnnotationWithNoScale),core.A.removeEventListener("annotationsLoaded",updateScales),core.A.removeEventListener("annotationChanged",updateScales)}}),[]),(0,react.useEffect)((function(){"AnnotationCreateCalibrationMeasurement"===activeToolName?(!isCalibration&&updateIsCalibration(!0),enableOrDisableToolElements(!0)):(updateIsCalibration(!1),enableOrDisableToolElements(!1))}),[activeToolName,updateIsCalibration,enableOrDisableToolElements]);var selectedScales=(0,react.useMemo)((function(){var scales=new Set;return _to_consumable_array(annotations).concat([selectedTool]).forEach((function(measurementItem){var _measurementItem_Measure,scale=null==measurementItem||null===(_measurementItem_Measure=measurementItem.Measure)||void 0===_measurementItem_Measure?void 0:_measurementItem_Measure.scale;scale&&!scales.has(scale)&&scales.add(scale)})),_to_consumable_array(scales)}),[annotations,selectedTool,scales]),totalScales=Object.keys(scales).map((function(scale){return new ScaleOverlay_Scale(scale)}));return isCalibration?react.createElement(ScaleOverlay_CalibrationOverlay,{tempScale,onCancelCalibrationMode:function(){return onCancelCalibrationMode(previousToolName)},onApplyCalibration:function(){return onApplyCalibration(previousToolName,tempScale,isFractionalUnit)},previousToolName}):react.createElement(react.Fragment,null,react.createElement(ScaleOverlay_ScaleHeader,{scales:totalScales,selectedScales,onScaleSelected,onAddingNewScale}),shouldShowMeasurementDetail&&react.createElement(MeasurementDetail.A,{annotation:annotations.length>1?null:annotations[0]||null,selectedTool,isOpen:!0}))};ScaleOverlay_ScaleOverlay.propTypes=ScaleOverlay_propTypes;const components_ScaleOverlay_ScaleOverlay=(0,react.memo)(ScaleOverlay_ScaleOverlay);ScaleOverlay_ScaleOverlay.__docgenInfo={description:"",methods:[],displayName:"ScaleOverlay",props:{annotations:{description:"",type:{name:"arrayOf",value:{name:"object"}},required:!0},selectedTool:{description:"",type:{name:"object"},required:!1},updateIsCalibration:{description:"",type:{name:"func"},required:!0},enableOrDisableToolElements:{description:"",type:{name:"func"},required:!0},onScaleSelected:{description:"",type:{name:"func"},required:!0},onCancelCalibrationMode:{description:"",type:{name:"func"},required:!0},onApplyCalibration:{description:"",type:{name:"func"},required:!0},onAddingNewScale:{description:"",type:{name:"func"},required:!0}}};var classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),cjs=__webpack_require__("./node_modules/react-draggable/build/cjs/cjs.js"),cjs_default=__webpack_require__.n(cjs),dataElement=__webpack_require__("./src/constants/dataElement.js"),MobilePopupWrapper=__webpack_require__("./src/components/MobilePopupWrapper/index.js"),getDeviceSize=__webpack_require__("./src/helpers/getDeviceSize.js");function ScaleOverlayContainer_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ScaleOverlayContainer_sliced_to_array(arr,i){return function ScaleOverlayContainer_array_with_holes(arr){if(Array.isArray(arr))return arr}(arr)||function ScaleOverlayContainer_iterable_to_array_limit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,i)||ScaleOverlayContainer_unsupported_iterable_to_array(arr,i)||function ScaleOverlayContainer_non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ScaleOverlayContainer_to_consumable_array(arr){return function ScaleOverlayContainer_array_without_holes(arr){if(Array.isArray(arr))return ScaleOverlayContainer_array_like_to_array(arr)}(arr)||function ScaleOverlayContainer_iterable_to_array(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||ScaleOverlayContainer_unsupported_iterable_to_array(arr)||function ScaleOverlayContainer_non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ScaleOverlayContainer_unsupported_iterable_to_array(o,minLen){if(o){if("string"==typeof o)return ScaleOverlayContainer_array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ScaleOverlayContainer_array_like_to_array(o,minLen):void 0}}var ScaleOverlayContainer_Scale=window.Core.Scale,measurementDataElements=["distanceToolGroupButton","arcMeasurementToolGroupButton","perimeterToolGroupButton","areaToolGroupButton","rectangleAreaToolGroupButton","ellipseAreaToolGroupButton","countToolGroupButton","cloudyRectangleAreaToolGroupButton","arcToolGroupButton"],ScaleOverlayContainer=function(param){var annotations=param.annotations,selectedTool=param.selectedTool,dispatch=(0,es.wA)(),t=ScaleOverlayContainer_sliced_to_array((0,useTranslation.B)(),1)[0],_useSelector=ScaleOverlayContainer_sliced_to_array((0,es.d4)((function(state){return[selectors.A.isElementDisabled(state,dataElement.A.SCALE_OVERLAY_CONTAINER),selectors.A.isElementOpen(state,dataElement.A.SCALE_OVERLAY_CONTAINER),selectors.A.getScaleOverlayPosition(state)]})),3),isDisabled=_useSelector[0],isOpen=_useSelector[1],initialPosition=_useSelector[2],_useState=ScaleOverlayContainer_sliced_to_array((0,react.useState)({x:0,y:0}),2),position=_useState[0],setPosition=_useState[1],forceUpdate=ScaleOverlayContainer_sliced_to_array((0,react.useReducer)((function(x){return x+1}),0,(function(){return 0})),2)[1],_useSelector1=ScaleOverlayContainer_sliced_to_array((0,es.d4)((function(state){return[selectors.A.getDocumentContainerWidth(state),selectors.A.getDocumentContainerHeight(state)]})),2),documentContainerWidth=_useSelector1[0],documentContainerHeight=_useSelector1[1],containerRef=(0,react.useRef)(null),documentElement=core.A.getViewerElement(),documentContainerElement=core.A.getScrollViewElement(),style=function(){var initialPositionParts=initialPosition.split("-"),offset={left:0,top:0};if("top"===initialPositionParts[0])offset.top=(null==documentElement?void 0:documentElement.offsetTop)+10||85;else{var containerHeight=400;(null==containerRef?void 0:containerRef.current)&&(containerHeight=containerRef.current.getBoundingClientRect().height),offset.top=documentContainerHeight+(null==documentContainerElement?void 0:documentContainerElement.offsetTop)-10-containerHeight||85}if("right"===initialPositionParts[1])offset.left=.666*documentContainerWidth,documentElement&&(null==containerRef?void 0:containerRef.current)&&(offset.left=Math.min((null==documentElement?void 0:documentElement.offsetLeft)+(null==documentElement?void 0:documentElement.offsetWidth)+10||offset.left,documentContainerWidth-containerRef.current.getBoundingClientRect().width-10));else{if(documentElement&&(null==containerRef?void 0:containerRef.current)){var containerWidth=containerRef.current.getBoundingClientRect().width;offset.left=(null==documentElement?void 0:documentElement.offsetLeft)-10-containerWidth||10,documentContainerElement&&offset.left<documentContainerElement.offsetLeft&&(offset.left=documentContainerElement.offsetLeft+10)}(!offset.left||isNaN(offset.left)||offset.left<0)&&(offset.left=10)}return offset}();(0,react.useEffect)((function(){setPosition({x:0,y:0})}),[initialPosition]);var initialPositionParts,bounds,syncDraggablePosition=function(e,param){var x=param.x,y=param.y;setPosition({x,y})},updateIsCalibration=(0,react.useCallback)((function(isCalibration){dispatch(actions.A.updateCalibrationInfo({isCalibration}))}),[]),enableOrDisableToolElements=(0,react.useCallback)((function(disabled){measurementDataElements.forEach((function(dataElement){dispatch(actions.A.setCustomElementOverrides(dataElement,{disabled}))}))}),[]),openScaleModal=(0,react.useCallback)((function(scale){scale&&function(scale){dispatch(actions.A.setSelectedScale(scale))}(new ScaleOverlayContainer_Scale(scale)),dispatch(actions.A.openElements([dataElement.A.SCALE_MODAL])),dispatch(actions.A.setIsAddingNewScale())}),[]),onScaleSelected=(0,react.useCallback)((function(selectedScales,scale){var newScale=new ScaleOverlayContainer_Scale(scale);if(1===selectedScales.length&&selectedScales.includes(scale))openScaleModal(scale);else{var applyTo=ScaleOverlayContainer_to_consumable_array(annotations).concat([selectedTool]),scaleToDelete=core.A.getDocumentViewer().getMeasurementManager().getOldScalesToDeleteAfterApplying({scale:newScale,applyTo})[0],createAndApplyScale=function(){core.A.createAndApplyScale(newScale,ScaleOverlayContainer_to_consumable_array(annotations).concat([selectedTool]))};scaleToDelete?confirmScaleToDelete(scaleToDelete,createAndApplyScale):createAndApplyScale()}}),[annotations,selectedTool]),confirmScaleToDelete=function(scaleToDelete,createAndApplyScale){var warning={message:react.createElement("div",{className:"customMessage"},react.createElement("p",null,react.createElement("span",null,t("option.measurement.deleteScaleModal.ifChangeScale"),react.createElement("b",null,scaleToDelete),t("option.measurement.deleteScaleModal.notUsedWillDelete"))),react.createElement("p",null,react.createElement("span",null,t("option.measurement.deleteScaleModal.ifToContinue")))),title:"".concat(t("option.measurement.deleteScaleModal.deleteScale")," ").concat(scaleToDelete),confirmBtnText:t("action.confirm"),onConfirm:function(){return createAndApplyScale()}};dispatch(actions.A.showWarningMessage(warning))},onCancelCalibrationMode=(0,react.useCallback)((function(previousToolName){core.A.setToolMode(previousToolName),updateIsCalibration(!1),dispatch(actions.A.setIsElementHidden(dataElement.A.SCALE_MODAL,!1))}),[]),onApplyCalibration=(0,react.useCallback)((function(previousToolName,tempScale,isFractionalUnit){dispatch(actions.A.updateCalibrationInfo({isCalibration:!1,tempScale,isFractionalUnit})),dispatch(actions.A.setIsElementHidden(dataElement.A.SCALE_MODAL,!1)),core.A.setToolMode(previousToolName),core.A.deleteAnnotations([annotations[0]])}),[annotations]),onAddingNewScale=(0,react.useCallback)((function(){openScaleModal(),dispatch(actions.A.setIsAddingNewScale(!0))}),[]);return(0,getDeviceSize.IS)()?!isDisabled&&react.createElement(MobilePopupWrapper.A,null,react.createElement(components_ScaleOverlay_ScaleOverlay,{annotations,selectedTool,updateIsCalibration,enableOrDisableToolElements,onScaleSelected,onCancelCalibrationMode,onApplyCalibration,onAddingNewScale,forceUpdate,tabIndex:0})):!isDisabled&&react.createElement(cjs_default(),{position,bounds:(initialPositionParts=initialPosition.split("-"),bounds={top:0,bottom:0,left:0,right:0},"top"===initialPositionParts[0]?(bounds.top=0,bounds.bottom=documentContainerHeight-20,containerRef.current?bounds.bottom-=containerRef.current.getBoundingClientRect().height:bounds.bottom-=85):(bounds.top=20-documentContainerHeight,containerRef.current?bounds.top+=containerRef.current.getBoundingClientRect().height:bounds.top+=85,bounds.bottom=0),"right"===initialPositionParts[1]?(bounds.left=-documentContainerWidth,bounds.right=documentContainerWidth/3,style&&(bounds.right=documentContainerWidth-style.left)):(bounds.left=null==documentContainerElement?void 0:documentContainerElement.offsetLeft,style&&(bounds.left=(null==documentContainerElement?void 0:documentContainerElement.offsetLeft)-style.left+10),bounds.right=documentContainerWidth-10-35,style&&(bounds.right-=style.left)),bounds),onDrag:syncDraggablePosition,onStop:syncDraggablePosition,cancel:".scale-overlay-selector, .add-new-scale"},react.createElement("div",{className:classnames_default()({Overlay:!0,ScaleOverlay:!0,open:isOpen,closed:!isOpen}),"data-element":dataElement.A.SCALE_OVERLAY_CONTAINER,style,ref:containerRef},react.createElement(components_ScaleOverlay_ScaleOverlay,{annotations,selectedTool,updateIsCalibration,enableOrDisableToolElements,onScaleSelected,onCancelCalibrationMode,onApplyCalibration,onAddingNewScale,forceUpdate,tabIndex:0})))};const ScaleOverlay_ScaleOverlayContainer=ScaleOverlayContainer;ScaleOverlayContainer.__docgenInfo={description:"",methods:[],displayName:"ScaleOverlayContainer"}},"./src/components/ScaleOverlay/ScaleSelector.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var classnames__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_0__),components_Icon__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/components/Icon/index.js"),components_DataElementWrapper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/DataElementWrapper/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_10__),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/index.js"),react_i18next__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),actions__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/redux/actions/index.js"),react_redux__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react-redux/es/index.js"),selectors__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/redux/selectors/index.js"),core__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/core/index.js"),hooks_useOnClickOutside__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/hooks/useOnClickOutside.js"),components_Button__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/components/Button/index.js");function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _sliced_to_array(arr,i){return function _array_with_holes(arr){if(Array.isArray(arr))return arr}(arr)||function _iterable_to_array_limit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,i)||_unsupported_iterable_to_array(arr,i)||function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _to_consumable_array(arr){return function _array_without_holes(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}(arr)||function _iterable_to_array(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupported_iterable_to_array(arr)||function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupported_iterable_to_array(o,minLen){if(o){if("string"==typeof o)return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_array_like_to_array(o,minLen):void 0}}var propTypes={scales:prop_types__WEBPACK_IMPORTED_MODULE_10___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_10___default().object).isRequired,selectedScales:prop_types__WEBPACK_IMPORTED_MODULE_10___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_10___default().string).isRequired,onScaleSelected:prop_types__WEBPACK_IMPORTED_MODULE_10___default().func.isRequired,onAddingNewScale:prop_types__WEBPACK_IMPORTED_MODULE_10___default().func.isRequired},Scale=window.Core.Scale,ScaleSelector=function(param){var _param_scales=param.scales,scales=void 0===_param_scales?[]:_param_scales,_param_selectedScales=param.selectedScales,selectedScales=void 0===_param_selectedScales?[]:_param_selectedScales,onScaleSelected=param.onScaleSelected,onAddingNewScale=param.onAddingNewScale,ariaLabelledBy=param.ariaLabelledBy,t=_sliced_to_array((0,react_i18next__WEBPACK_IMPORTED_MODULE_11__.B)(),1)[0],dispatch=(0,react_redux__WEBPACK_IMPORTED_MODULE_5__.wA)(),isMultipleScalesMode=(0,react_redux__WEBPACK_IMPORTED_MODULE_5__.d4)((function(state){return selectors__WEBPACK_IMPORTED_MODULE_6__.A.getIsMultipleScalesMode(state)})),isMultipleScales=selectedScales.length>1,getScaleInfo=function(deleteScale){var scales=core__WEBPACK_IMPORTED_MODULE_7__.A.getScales(),measurements=[],relatedPages=new Set;return scales[deleteScale.toString()].forEach((function(measurementItem){(function _instanceof(left,right){return null!=right&&"undefined"!=typeof Symbol&&right[Symbol.hasInstance]?!!right[Symbol.hasInstance](left):left instanceof right})(measurementItem,window.Core.Annotations.Annotation)&&(relatedPages.add(measurementItem.PageNumber),measurements.push(measurementItem))})),{measurementsNum:measurements.length,pages:_to_consumable_array(relatedPages)}},openScaleDeletionModal=function(scale){if(scale){var deleteScale=new Scale(scale),scaleInfo=getScaleInfo(deleteScale),warning={message:!!scaleInfo.pages.length?react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",{className:"customMessage"},react__WEBPACK_IMPORTED_MODULE_3__.createElement("p",null,react__WEBPACK_IMPORTED_MODULE_3__.createElement("span",null,t("option.measurement.deleteScaleModal.scaleIsOn-delete-info"),react__WEBPACK_IMPORTED_MODULE_3__.createElement("b",null," ".concat(t("option.measurement.deleteScaleModal.page-delete-info")," ").concat(scaleInfo.pages.join(", ")," ")),t("option.measurement.deleteScaleModal.appliedTo-delete-info"),react__WEBPACK_IMPORTED_MODULE_3__.createElement("b",null," ".concat(scaleInfo.measurementsNum," ").concat(scaleInfo.measurementsNum>1?t("option.measurement.deleteScaleModal.measurements"):t("option.measurement.deleteScaleModal.measurement"),"."))),react__WEBPACK_IMPORTED_MODULE_3__.createElement("span",null," "),react__WEBPACK_IMPORTED_MODULE_3__.createElement("span",null,t("option.measurement.deleteScaleModal.deletionIs"),react__WEBPACK_IMPORTED_MODULE_3__.createElement("b",null," ".concat(t("option.measurement.deleteScaleModal.irreversible")," ")),t("option.measurement.deleteScaleModal.willDeleteMeasurement"))),react__WEBPACK_IMPORTED_MODULE_3__.createElement("p",null,t("option.measurement.deleteScaleModal.confirmDelete"))):react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",{className:"customMessage"},react__WEBPACK_IMPORTED_MODULE_3__.createElement("p",null,react__WEBPACK_IMPORTED_MODULE_3__.createElement("span",null,t("option.measurement.deleteScaleModal.confirmDelete"),t("option.measurement.deleteScaleModal.thisCantBeUndone")))),title:"".concat(t("option.measurement.deleteScaleModal.deleteScale")," ").concat(deleteScale.toString()),confirmBtnText:t("action.confirm"),onConfirm:function(){return core__WEBPACK_IMPORTED_MODULE_7__.A.deleteScale(deleteScale)}};dispatch(actions__WEBPACK_IMPORTED_MODULE_4__.A.showWarningMessage(warning))}},renderScale=function(scale){var precision=core__WEBPACK_IMPORTED_MODULE_7__.A.getScalePrecision(scale),pageScaleStr=Scale.getFormattedValue(scale.pageScale.value,scale.pageScale.unit,precision,!1),worldScaleStr=Scale.getFormattedValue(scale.worldScale.value,scale.worldScale.unit,precision,!1),scaleDisplay="".concat(pageScaleStr," = ").concat(worldScaleStr);return react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",null,scaleDisplay)},title=t("option.measurement.scaleOverlay.multipleScales");if(selectedScales.length&&!isMultipleScales){var selectedScale=new Scale(selectedScales[0]);title=renderScale(selectedScale)}var _useState=_sliced_to_array((0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(!1),2),isDropDownOpen=_useState[0],setOpenDropDown=_useState[1],toggleDropdown=function(){setOpenDropDown((function(prevValue){return!prevValue}))},selectorRef=(0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)(null);(0,hooks_useOnClickOutside__WEBPACK_IMPORTED_MODULE_8__.A)(selectorRef,(function(){setOpenDropDown(!1)}));return react__WEBPACK_IMPORTED_MODULE_3__.createElement(components_DataElementWrapper__WEBPACK_IMPORTED_MODULE_2__.A,{className:"scale-overlay-selector",dataElement:"scaleSelector",tabIndex:-1,ref:selectorRef,onKeyDown:function(e){"Enter"!==e.key&&" "!==e.key||toggleDropdown()},onClick:toggleDropdown},react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",{"data-testid":"scale-selector",className:"scale-overlay-selection","aria-expanded":isDropDownOpen,"aria-labelledby":ariaLabelledBy,role:"combobox",tabIndex:0},react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",{className:"scale-overlay-item"},react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",{className:"scale-overlay-name"},title),react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",{className:"scale-overlay-arrow"},react__WEBPACK_IMPORTED_MODULE_3__.createElement(components_Icon__WEBPACK_IMPORTED_MODULE_1__.A,{glyph:"icon-chevron-down",ariaHidden:!0})))),isDropDownOpen&&react__WEBPACK_IMPORTED_MODULE_3__.createElement("ul",{className:classnames__WEBPACK_IMPORTED_MODULE_0___default()("scale-overlay-list")},react__WEBPACK_IMPORTED_MODULE_3__.createElement("li",null,react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",{className:"scale-overlay-name"},title),react__WEBPACK_IMPORTED_MODULE_3__.createElement("div",{className:"scale-overlay-arrow"},react__WEBPACK_IMPORTED_MODULE_3__.createElement("button",{className:"scale-overlay-selected-arrow"},react__WEBPACK_IMPORTED_MODULE_3__.createElement(components_Icon__WEBPACK_IMPORTED_MODULE_1__.A,{glyph:"icon-chevron-up",ariaHidden:!0})))),scales.map((function(value){return react__WEBPACK_IMPORTED_MODULE_3__.createElement("li",{key:value.toString(),className:classnames__WEBPACK_IMPORTED_MODULE_0___default()({'className="scale-overlay-item':!0,"option-selected":selectedScales.includes(value.toString())})},react__WEBPACK_IMPORTED_MODULE_3__.createElement("button",{className:classnames__WEBPACK_IMPORTED_MODULE_0___default()({options:!0}),onClick:function(){return onScaleSelected(selectedScales,value.toString())},onKeyDown:function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),onScaleSelected(selectedScales,value.toString()))}},renderScale(value)),react__WEBPACK_IMPORTED_MODULE_3__.createElement("button",{className:"delete",tabIndex:0,onClick:function(e){e.preventDefault(),e.stopPropagation(),openScaleDeletionModal(value.toString())},onKeyDown:function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),openScaleDeletionModal(value.toString()))},disabled:scales.length<=1,"aria-label":"".concat(t("action.delete")," ").concat(value.toString())},react__WEBPACK_IMPORTED_MODULE_3__.createElement(components_Icon__WEBPACK_IMPORTED_MODULE_1__.A,{glyph:"icon-delete-line"})))})),isMultipleScalesMode&&react__WEBPACK_IMPORTED_MODULE_3__.createElement("li",null,react__WEBPACK_IMPORTED_MODULE_3__.createElement(components_Button__WEBPACK_IMPORTED_MODULE_9__.A,{onClick:onAddingNewScale,label:t("option.measurement.scaleOverlay.addNewScale"),className:"add-new-scale"}))))};ScaleSelector.propTypes=propTypes;const __WEBPACK_DEFAULT_EXPORT__=ScaleSelector;ScaleSelector.__docgenInfo={description:"",methods:[],displayName:"ScaleSelector",props:{scales:{defaultValue:{value:"[]",computed:!1},description:"",type:{name:"arrayOf",value:{name:"object"}},required:!1},selectedScales:{defaultValue:{value:"[]",computed:!1},description:"",type:{name:"arrayOf",value:{name:"string"}},required:!1},onScaleSelected:{description:"",type:{name:"func"},required:!0},onAddingNewScale:{description:"",type:{name:"func"},required:!0}}}}}]);