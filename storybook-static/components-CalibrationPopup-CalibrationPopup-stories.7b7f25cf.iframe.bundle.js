(self.webpackChunkwebviewer_ui=self.webpackChunkwebviewer_ui||[]).push([[6897],{"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js??ruleSet[1].rules[13].use[2]!./node_modules/sass-loader/dist/cjs.js!./src/components/CalibrationPopup/CalibrationPopup.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,":host{display:inline-block;container-type:inline-size;width:100%;height:100%;overflow:hidden}@media(min-width:901px){.App:not(.is-web-component) .hide-in-desktop{display:none}}@container (min-width: 901px){.hide-in-desktop{display:none}}@media(min-width:641px)and (max-width:900px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .hide-in-tablet{display:none}}@container (min-width: 641px) and (max-width: 900px){.App.is-web-component:not(.is-in-desktop-only-mode) .hide-in-tablet{display:none}}@media(max-width:640px)and (min-width:431px){.App:not(.is-web-component) .hide-in-mobile{display:none}}@container (max-width: 640px) and (min-width: 431px){.App.is-web-component .hide-in-mobile{display:none}}@media(max-width:430px){.App:not(.is-web-component) .hide-in-small-mobile{display:none}}@container (max-width: 430px){.App.is-web-component .hide-in-small-mobile{display:none}}.always-hide{display:none}@keyframes bottom-up{0%{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes up-bottom{0%{transform:translateY(0)}to{transform:translateY(100%)}}.CalibrationPopup{display:flex;flex-direction:column;align-items:flex-start;padding:var(--padding-medium);width:220px;background:var(--gray-0);box-shadow:0 0 3px var(--gray-7);border-radius:4px}.CalibrationPopup .calibration-popup-label{font-weight:700;margin-bottom:var(--padding-medium)}.CalibrationPopup .pop-switch{margin-top:var(--padding-medium)}.CalibrationPopup .pop-switch.ui__choice--disabled .ui__choice__label{color:var(--gray-5)}.CalibrationPopup .input-container{display:flex;flex-direction:row;justify-content:space-between;align-items:flex-start;grid-gap:var(--padding-small);gap:var(--padding-small);height:32px}.CalibrationPopup .input-container .input-field{width:94px;height:32px}.CalibrationPopup .input-container .input-field.invalid-value{border-color:red}.CalibrationPopup .input-container .input-field:focus{border:1px solid var(--blue-5)}.CalibrationPopup .input-container .input-field .Dropdown__wrapper{width:100%;height:100%}.CalibrationPopup .input-container .input-field .Dropdown__wrapper .Dropdown{height:100%;width:100%!important;text-align:start}.CalibrationPopup .input-container .input-field .Dropdown__wrapper .Dropdown__items{width:100%}",""]),exports.locals={LEFT_HEADER_WIDTH:"41px",RIGHT_HEADER_WIDTH:"41px"},module.exports=exports},"./src/components/CalibrationPopup/CalibrationPopup.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),selectors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/redux/selectors/index.js"),react_redux__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react-redux/es/index.js"),core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/core/index.js"),actions__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/redux/actions/index.js"),_pdftron_webviewer_react_toolkit__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@pdftron/webviewer-react-toolkit/dist/esm/components/Choice/Choice.js"),_Dropdown__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/components/Dropdown/index.js"),_Tooltip__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/components/Tooltip/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_11__),react_i18next__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/constants/measurementScale.js"),classnames__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_9__);__webpack_require__("./src/components/CalibrationPopup/CalibrationPopup.scss");const Scale=window.Core.Scale,parseMeasurementContentsByAnnotation=annotation=>{const factor=annotation.Measure.axis[0].factor;return"ft-in"===annotation.Scale[1][1]?annotation.getLineLength()*factor/12:annotation.getLineLength()*factor},CalibrationPropType={annotation:prop_types__WEBPACK_IMPORTED_MODULE_11___default().shape({Scale:prop_types__WEBPACK_IMPORTED_MODULE_11___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_11___default().array)})},CalibrationPopup=({annotation})=>{const[t]=(0,react_i18next__WEBPACK_IMPORTED_MODULE_12__.B)(),dispatch=(0,react_redux__WEBPACK_IMPORTED_MODULE_3__.wA)(),[measurementUnits,{tempScale,isFractionalUnit,defaultUnit}]=(0,react_redux__WEBPACK_IMPORTED_MODULE_3__.d4)((state=>[selectors__WEBPACK_IMPORTED_MODULE_2__.A.getMeasurementUnits(state),selectors__WEBPACK_IMPORTED_MODULE_2__.A.getCalibrationInfo(state)]),react_redux__WEBPACK_IMPORTED_MODULE_3__.bN),[valueDisplay,setValueDisplay]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),inputRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),unitTo=new Scale(tempScale).worldScale?.unit||"mm",unitToOptions=isFractionalUnit?measurementUnits.to.filter((unit=>constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.Ph.includes(unit))):measurementUnits.to,isFractionalUnitsToggleDisabled=!constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.Ph.includes(unitTo),valueInputType=isFractionalUnit||"ft-in"===unitTo?"text":"number",inputValueClass=classnames__WEBPACK_IMPORTED_MODULE_9___default()("input-field",{"invalid-value":!(tempScale&&new Scale(tempScale).worldScale?.value>0)}),updateTempScale=(scaleValue,scaleUnit)=>{const currentDistance=parseMeasurementContentsByAnnotation(annotation),currentScale=annotation.Scale,newRatio=currentDistance/currentScale[1][0],pageScale=[currentScale[0][0]*newRatio,currentScale[0][1]],defaultPageUnit="pt"===(pageUnit=scaleUnit)?"pt":constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.EN.includes(pageUnit)?"mm":"in";var pageUnit;const defaultPageValue=(0,constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.oU)(pageScale[0],pageScale[1],defaultPageUnit);dispatch(actions__WEBPACK_IMPORTED_MODULE_5__.A.updateCalibrationInfo({tempScale:`${defaultPageValue} ${defaultPageUnit} = ${scaleValue} ${scaleUnit}`,isFractionalUnit}))},setValue=scaleValue=>{updateTempScale(scaleValue,new Scale(tempScale).worldScale?.unit)},updateValueDisplay=()=>{const scaleValue=new Scale(tempScale).worldScale?.value;let newValueDisplay;newValueDisplay=isFractionalUnit||"ft-in"===unitTo?Scale.getFormattedValue(scaleValue,unitTo,isFractionalUnit?1/64:1e-4,!1,!0):`${scaleValue}`,setValueDisplay(newValueDisplay||"")},tempScaleRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(tempScale);return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((()=>{tempScaleRef.current=tempScale}),[tempScale]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((()=>{if(annotation){const value=parseMeasurementContentsByAnnotation(annotation),unit=annotation.Scale[1][1];defaultUnit?updateTempScale((0,constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.oU)(value,unit,defaultUnit),defaultUnit):updateTempScale(value,unit)}const onAnnotationChanged=(annotations,action)=>{if("modify"===action&&1===annotations.length&&annotations[0]===annotation){const value=parseMeasurementContentsByAnnotation(annotation),unit=annotation.Scale[1][1],currentUnit=new Scale(tempScaleRef.current).worldScale?.unit;currentUnit?updateTempScale((0,constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.oU)(value,unit,currentUnit),currentUnit):updateTempScale(value,unit)}};return core__WEBPACK_IMPORTED_MODULE_4__.A.addEventListener("annotationChanged",onAnnotationChanged),()=>{core__WEBPACK_IMPORTED_MODULE_4__.A.removeEventListener("annotationChanged",onAnnotationChanged),core__WEBPACK_IMPORTED_MODULE_4__.A.deleteAnnotations([annotation])}}),[annotation]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((()=>{inputRef?.current!==document.activeElement&&updateValueDisplay()}),[tempScale,isFractionalUnit]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"CalibrationPopup","data-element":"calibrationPopup",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("label",{className:"calibration-popup-label",id:"calibration-popup-label",htmlFor:"calibration-popup-value",children:t("option.measurement.scaleModal.units")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"input-container",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("input",{id:"calibration-popup-value",className:inputValueClass,ref:inputRef,type:valueInputType,value:valueDisplay,min:"0",onChange:e=>{setValueDisplay(e.target.value);const inputValue=e.target.value.trim();if(isFractionalUnit){if("in"===unitTo){if(constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.yQ.test(inputValue)){const result=(0,constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.cX)(inputValue);if(result>0)return void setValue(result)}}else if("ft-in"===unitTo&&constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.CR.test(inputValue)){const result=(0,constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.QQ)(inputValue);if(result>0)return void setValue(result)}}else if("ft-in"===unitTo&&constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.oi.test(inputValue)){const result=(0,constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.Cg)(inputValue);if(result>0)return void setValue(result)}else if(constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.SY.test(inputValue)){const result=parseFloat(inputValue)||0;return void setValue(result)}setValue(0)},onBlur:()=>{updateValueDisplay()},placeholder:isFractionalUnit?constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.OR[unitTo]:"ft-in"===unitTo?constants_measurementScale__WEBPACK_IMPORTED_MODULE_8__.OR["ft-in decimal"]:""}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_Tooltip__WEBPACK_IMPORTED_MODULE_7__.A,{content:"option.measurement.scaleModal.displayUnits",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"input-field",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_Dropdown__WEBPACK_IMPORTED_MODULE_6__.A,{id:"calibration-popup-units",dataElement:"calibrationUnits",items:unitToOptions,currentSelectionKey:unitTo,onClickItem:scaleUnit=>{updateTempScale(new Scale(tempScale).worldScale?.value,scaleUnit)},labelledById:"calibration-popup-label"})})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_Tooltip__WEBPACK_IMPORTED_MODULE_7__.A,{content:t("option.measurement.scaleModal.fractionUnitsTooltip"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_pdftron_webviewer_react_toolkit__WEBPACK_IMPORTED_MODULE_13__.G,{isSwitch:!0,leftLabel:!0,label:t("option.measurement.scaleModal.fractionalUnits"),disabled:isFractionalUnitsToggleDisabled,checked:isFractionalUnit,id:"calibration-popup-fractional-units",className:"pop-switch",onChange:()=>{dispatch(actions__WEBPACK_IMPORTED_MODULE_5__.A.updateCalibrationInfo({tempScale,isFractionalUnit:!isFractionalUnit}))}})})})]})};CalibrationPopup.propTypes=CalibrationPropType;const __WEBPACK_DEFAULT_EXPORT__=CalibrationPopup;CalibrationPopup.__docgenInfo={description:"",methods:[],displayName:"CalibrationPopup",props:{annotation:{description:"",type:{name:"shape",value:{Scale:{name:"arrayOf",value:{name:"array"},required:!1}}},required:!1}}}},"./src/components/CalibrationPopup/CalibrationPopup.scss":(module,__unused_webpack_exports,__webpack_require__)=>{var api=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js??ruleSet[1].rules[13].use[2]!./node_modules/sass-loader/dist/cjs.js!./src/components/CalibrationPopup/CalibrationPopup.scss");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.id,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/components/CalibrationPopup/CalibrationPopup.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Basic:()=>Basic,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/jsx-runtime.js"),redux__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/redux/es/redux.js")),react_redux__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-redux/es/index.js"),_CalibrationPopup__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/CalibrationPopup/CalibrationPopup.js"),reducers_viewerReducer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/redux/reducers/viewerReducer.js"),src_redux_initialState__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/redux/initialState.js");const __WEBPACK_DEFAULT_EXPORT__={title:"Components/CalibrationPopup",component:_CalibrationPopup__WEBPACK_IMPORTED_MODULE_3__.A,argTypes:{annotation:{table:{disable:!0}},style:{table:{disable:!0}}}},reducer=(0,redux__WEBPACK_IMPORTED_MODULE_6__.HY)({viewer:(0,reducers_viewerReducer__WEBPACK_IMPORTED_MODULE_4__.A)(src_redux_initialState__WEBPACK_IMPORTED_MODULE_5__.A.viewer)}),store=(0,redux__WEBPACK_IMPORTED_MODULE_6__.y$)(reducer),distanceMeasurementAnnot=new window.Core.Annotations.LineAnnotation;distanceMeasurementAnnot.Measure={scale:"1 in = 1 in",axis:[{factor:.0138889,unit:"in",decimalSymbol:".",thousandsSymbol:",",display:"D",precision:100,unitPrefix:"",unitSuffix:"",unitPosition:"S"}],distance:[{factor:1,unit:"in",decimalSymbol:".",thousandsSymbol:",",display:"D",precision:100,unitPrefix:"",unitSuffix:"",unitPosition:"S"}],area:[{factor:1,unit:"sq in",decimalSymbol:".",thousandsSymbol:",",display:"D",precision:100,unitPrefix:"",unitSuffix:"",unitPosition:"S"}]},distanceMeasurementAnnot.IT="LineDimension",distanceMeasurementAnnot.DisplayUnits=["in"],distanceMeasurementAnnot.Scale=[[1,"in"],[1,"in"]],distanceMeasurementAnnot.Precision=.01;const Basic=(args=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_redux__WEBPACK_IMPORTED_MODULE_2__.Kq,{store,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_CalibrationPopup__WEBPACK_IMPORTED_MODULE_3__.A,{...args})})).bind({});Basic.args={annotation:distanceMeasurementAnnot};const __namedExportsOrder=["Basic"]}}]);