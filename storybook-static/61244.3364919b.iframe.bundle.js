(self.webpackChunkwebviewer_ui=self.webpackChunkwebviewer_ui||[]).push([[61244],{"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js??ruleSet[1].rules[13].use[2]!./node_modules/sass-loader/dist/cjs.js!./src/components/AnnotationNoteConnectorLine/AnnotationNoteConnectorLine.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,":host{display:inline-block;container-type:inline-size;width:100%;height:100%;overflow:hidden}@media(min-width:901px){.App:not(.is-web-component) .hide-in-desktop{display:none}}@container (min-width: 901px){.hide-in-desktop{display:none}}@media(min-width:641px)and (max-width:900px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .hide-in-tablet{display:none}}@container (min-width: 641px) and (max-width: 900px){.App.is-web-component:not(.is-in-desktop-only-mode) .hide-in-tablet{display:none}}@media(max-width:640px)and (min-width:431px){.App:not(.is-web-component) .hide-in-mobile{display:none}}@container (max-width: 640px) and (min-width: 431px){.App.is-web-component .hide-in-mobile{display:none}}@media(max-width:430px){.App:not(.is-web-component) .hide-in-small-mobile{display:none}}@container (max-width: 430px){.App.is-web-component .hide-in-small-mobile{display:none}}.always-hide{display:none}@keyframes bottom-up{0%{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes up-bottom{0%{transform:translateY(0)}to{transform:translateY(100%)}}@media print{#line-connector-root{opacity:0}}#line-connector-root{position:relative;z-index:69}.horizontalLine{height:2px}.horizontalLine,.verticalLine{background-color:rgba(30,120,235,.5);position:fixed}.verticalLine{width:2px}.arrowHead{position:absolute;inset-block-start:0;inset-inline-start:0;margin:auto;width:0;height:0;border-top:6px solid transparent;border-bottom:6px solid transparent;border-inline-end:7px solid rgba(30,120,235,.5);transform:translateX(-100%) translateY(-50%) translateY(1px)}",""]),exports.locals={LEFT_HEADER_WIDTH:"41px",RIGHT_HEADER_WIDTH:"41px"},module.exports=exports},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js??ruleSet[1].rules[13].use[2]!./node_modules/sass-loader/dist/cjs.js!./src/components/Note/Note.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,":host{display:inline-block;container-type:inline-size;width:100%;height:100%;overflow:hidden}@media(min-width:901px){.App:not(.is-web-component) .hide-in-desktop{display:none}}@container (min-width: 901px){.hide-in-desktop{display:none}}@media(min-width:641px)and (max-width:900px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .hide-in-tablet{display:none}}@container (min-width: 641px) and (max-width: 900px){.App.is-web-component:not(.is-in-desktop-only-mode) .hide-in-tablet{display:none}}@media(max-width:640px)and (min-width:431px){.App:not(.is-web-component) .hide-in-mobile{display:none}}@container (max-width: 640px) and (min-width: 431px){.App.is-web-component .hide-in-mobile{display:none}}@media(max-width:430px){.App:not(.is-web-component) .hide-in-small-mobile{display:none}}@container (max-width: 430px){.App.is-web-component .hide-in-small-mobile{display:none}}.always-hide{display:none}.Note{padding:0;border:none;background-color:transparent;display:block;text-align:start;border-radius:4px;box-shadow:0 0 3px 0 var(--note-box-shadow);margin-bottom:8px;margin-inline-start:2px;background:var(--component-background);cursor:pointer;position:relative}:host(:not([data-tabbing=true])) .Note,html:not([data-tabbing=true]) .Note{outline:none}.Note.unread{border:1.2px solid #00a5e4}.Note.expanded{box-shadow:0 4px 16px var(--note-box-shadow-expanded),0 0 4px 0 var(--note-box-shadow)}.Note.is-multi-selected{box-shadow:0 4px 16px rgba(134,142,150,.24),0 0 4px 0 var(--note-box-shadow)}.Note.disabled{opacity:.5;pointer-events:none}.Note .note-button{position:absolute;width:100%;height:100%;inset-block-start:0;inset-inline-start:0}.Note .mark-all-read-button{background:#00a5e4;text-align:center;color:#fff;height:16px;font-size:12px;width:100%;border-radius:0}.Note .divider{height:1px;width:100%;background:var(--divider)}.Note .reply-divider{background:var(--reply-divider);height:1px;width:100%}.Note .replies{margin-inline-start:52px;padding-bottom:12px}.Note .reply{padding-inline-start:12px;padding-bottom:24px;border-inline-start:1px solid var(--reply-divider)}.Note .reply:last-of-type{padding-bottom:0}.Note .group-section{margin-inline-start:52px;padding-bottom:12px;display:flex;flex-direction:column;grid-row-gap:4px;row-gap:4px;padding-inline-end:12px}.Note .group-section.modular-ui .group-child:hover{border:none;box-shadow:inset 0 0 0 1px var(--blue-6);background:var(--faded-component-background);border-radius:4px}.Note .text-button{color:var(--secondary-button-text);display:flex;position:relative;width:auto;height:auto;flex-direction:row-reverse;justify-content:flex-end}.Note .text-button .Icon{color:var(--secondary-button-text);height:18px;width:18px}.Note .group-child{position:relative;width:auto;height:auto;display:block;text-align:start;padding-top:4px;padding-bottom:4px}.Note .group-child:hover{background:var(--view-header-button-hover)}.Note .group-child .NoteContent{padding-bottom:0}.Note:focus{outline:none}.Note.focus-visible,.Note:focus-visible{outline:var(--focus-visible-outline)}",""]),exports.locals={LEFT_HEADER_WIDTH:"41px",RIGHT_HEADER_WIDTH:"41px"},module.exports=exports},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js??ruleSet[1].rules[13].use[2]!./node_modules/sass-loader/dist/cjs.js!./src/components/Note/ReplyArea/ReplyArea.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,":host{display:inline-block;container-type:inline-size;width:100%;height:100%;overflow:hidden}@media(min-width:901px){.App:not(.is-web-component) .hide-in-desktop{display:none}}@container (min-width: 901px){.hide-in-desktop{display:none}}@media(min-width:641px)and (max-width:900px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .hide-in-tablet{display:none}}@container (min-width: 641px) and (max-width: 900px){.App.is-web-component:not(.is-in-desktop-only-mode) .hide-in-tablet{display:none}}@media(max-width:640px)and (min-width:431px){.App:not(.is-web-component) .hide-in-mobile{display:none}}@container (max-width: 640px) and (min-width: 431px){.App.is-web-component .hide-in-mobile{display:none}}@media(max-width:430px){.App:not(.is-web-component) .hide-in-small-mobile{display:none}}@container (max-width: 430px){.App.is-web-component .hide-in-small-mobile{display:none}}.always-hide{display:none}.reply-area-container{border-top:1px solid var(--divider);display:flex;flex-direction:column;margin-bottom:0}.reply-area-container .reply-attachment-list{margin:12px 12px 0}.reply-area-container .reply-area-with-button{display:flex}.reply-area-container .reply-area-with-button .reply-area{position:relative;flex:1;margin:12px 17px 12px 12px;border-radius:4px;align-items:center}.reply-area-container .reply-area-with-button .reply-area.unread{background:rgba(0,165,228,.08)}.reply-area-container .reply-area-with-button .reply-area .comment-textarea .ql-container .ql-editor.ql-blank{padding:4px}.reply-area-container .reply-area-with-button .reply-area .comment-textarea .ql-container .ql-editor.ql-blank:before{inset-inline-start:4px}.reply-area-container .reply-area-with-button .reply-button-container{display:flex;flex-direction:column;justify-content:flex-end}.reply-area-container .reply-area-with-button .reply-button-container .reply-button{width:28px;height:28px;padding:0;border:none;background-color:transparent;inset-inline-end:10px;inset-block-end:12px}:host(:not([data-tabbing=true])) .reply-area-container .reply-area-with-button .reply-button-container .reply-button,html:not([data-tabbing=true]) .reply-area-container .reply-area-with-button .reply-button-container .reply-button{outline:none}@media (-ms-high-contrast:active),(-ms-high-contrast:none){.reply-area-container .reply-area-with-button .reply-button-container .reply-button{width:80px}}.reply-area-container .reply-area-with-button .reply-button-container .reply-button:hover{background:var(--blue-1)}.reply-area-container .reply-area-with-button .reply-button-container .reply-button.disabled{cursor:not-allowed}",""]),exports.locals={LEFT_HEADER_WIDTH:"41px",RIGHT_HEADER_WIDTH:"41px"},module.exports=exports},"./src/components/AnnotationNoteConnectorLine/AnnotationNoteConnectorLine.scss":(module,__unused_webpack_exports,__webpack_require__)=>{var api=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js??ruleSet[1].rules[13].use[2]!./node_modules/sass-loader/dist/cjs.js!./src/components/AnnotationNoteConnectorLine/AnnotationNoteConnectorLine.scss");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.id,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/components/Note/Note.scss":(module,__unused_webpack_exports,__webpack_require__)=>{var api=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js??ruleSet[1].rules[13].use[2]!./node_modules/sass-loader/dist/cjs.js!./src/components/Note/Note.scss");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.id,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/components/Note/ReplyArea/ReplyArea.scss":(module,__unused_webpack_exports,__webpack_require__)=>{var api=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js??ruleSet[1].rules[13].use[2]!./node_modules/sass-loader/dist/cjs.js!./src/components/Note/ReplyArea/ReplyArea.scss");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.id,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/components/Note/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>components_Note});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),es=__webpack_require__("./node_modules/react-redux/es/index.js"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),Context=__webpack_require__("./src/components/Note/Context.js");const components_NoteContent=__webpack_require__("./src/components/NoteContent/NoteContent.js").A;var NoteTextarea=__webpack_require__("./src/components/NoteTextarea/index.js"),ReplyAttachmentList=__webpack_require__("./src/components/ReplyAttachmentList/index.js"),Button=__webpack_require__("./src/components/Button/index.js"),core=__webpack_require__("./src/core/index.js"),MentionsManager=__webpack_require__("./src/helpers/MentionsManager.js"),setAnnotationRichTextStyle=__webpack_require__("./src/helpers/setAnnotationRichTextStyle.js"),ReplyAttachmentManager=__webpack_require__("./src/helpers/ReplyAttachmentManager.js"),useDidUpdate=__webpack_require__("./src/hooks/useDidUpdate.js"),actions=__webpack_require__("./src/redux/actions/index.js"),selectors=__webpack_require__("./src/redux/selectors/index.js"),device=__webpack_require__("./src/helpers/device.js"),dataElement=__webpack_require__("./src/constants/dataElement.js");__webpack_require__("./src/components/Note/ReplyArea/ReplyArea.scss");const propTypes={annotation:prop_types_default().object.isRequired},ReplyArea_ReplyArea=({annotation,isUnread,onPendingReplyChange})=>{const[autoFocusNoteOnAnnotationSelection,isReadOnly,isReplyDisabled,isReplyDisabledForAnnotation,isMentionEnabled,isNoteEditingTriggeredByAnnotationPopup,isInlineCommentDisabled,isInlineCommentOpen,activeDocumentViewerKey]=(0,es.d4)((state=>[selectors.A.getAutoFocusNoteOnAnnotationSelection(state),selectors.A.isDocumentReadOnly(state),selectors.A.isElementDisabled(state,"noteReply"),selectors.A.getIsReplyDisabled(state)?.(annotation),selectors.A.getIsMentionEnabled(state),selectors.A.getIsNoteEditing(state),selectors.A.isElementDisabled(state,dataElement.A.INLINE_COMMENT_POPUP),selectors.A.isElementOpen(state,dataElement.A.INLINE_COMMENT_POPUP),selectors.A.getActiveDocumentViewerKey(state)]),es.bN),{isContentEditable,isSelected,pendingReplyMap,setPendingReply,isExpandedFromSearch,scrollToSelectedAnnot,setCurAnnotId,pendingAttachmentMap,clearAttachments,deleteAttachment}=(0,react.useContext)(Context.A),[isFocused,setIsFocused]=(0,react.useState)(!1),dispatch=(0,es.wA)(),textareaRef=(0,react.useRef)(),shouldNotFocusOnInput=!isInlineCommentDisabled&&isInlineCommentOpen&&(0,device.Fr)();(0,useDidUpdate.A)((()=>{isFocused||dispatch(actions.A.finishNoteEditing())}),[isFocused]),(0,react.useEffect)((()=>{shouldNotFocusOnInput||isNoteEditingTriggeredByAnnotationPopup&&isSelected&&!isContentEditable&&autoFocusNoteOnAnnotationSelection&&textareaRef&&textareaRef.current&&textareaRef.current.focus()}),[isContentEditable,isNoteEditingTriggeredByAnnotationPopup,isSelected,shouldNotFocusOnInput]),(0,react.useEffect)((()=>{if(!isExpandedFromSearch&&scrollToSelectedAnnot&&setTimeout((()=>{textareaRef&&textareaRef.current&&autoFocusNoteOnAnnotationSelection&&textareaRef.current.focus()}),100),textareaRef&&textareaRef.current){if(shouldNotFocusOnInput)return;const lastNewLineCharacterLength=1,textLength=textareaRef.current.getEditor().getLength()-lastNewLineCharacterLength;setTimeout((()=>{textareaRef.current&&textareaRef.current.editor.setSelection(textLength,textLength)}),100)}}),[]);const postReply=async e=>{e.preventDefault(),e.stopPropagation();const editor=textareaRef.current.getEditor(),replyText=MentionsManager.A.getFormattedTextFromDeltas(editor.getContents());if(replyText.trim()){if(isMentionEnabled){const replyAnnotation=MentionsManager.A.createMentionReply(annotation,replyText);(0,setAnnotationRichTextStyle.A)(editor,replyAnnotation),await(0,ReplyAttachmentManager.ET)(replyAnnotation,pendingAttachmentMap[annotation.Id]),core.A.addAnnotations([replyAnnotation],activeDocumentViewerKey)}else{const replyAnnotation=core.A.createAnnotationReply(annotation,replyText);(0,setAnnotationRichTextStyle.A)(editor,replyAnnotation),await(0,ReplyAttachmentManager.ET)(replyAnnotation,pendingAttachmentMap[annotation.Id]),core.A.getAnnotationManager(activeDocumentViewerKey).trigger("annotationChanged",[[replyAnnotation],"modify",{}])}setPendingReply("",annotation.Id),clearAttachments(annotation.Id)}},ifReplyNotAllowed=isReadOnly||isReplyDisabled||isReplyDisabledForAnnotation,replyAreaClass=classnames_default()({"reply-area":!0,unread:isUnread}),pendingAttachments=pendingAttachmentMap[annotation.Id]||[];return ifReplyNotAllowed||!isSelected?null:(0,jsx_runtime.jsxs)("form",{onSubmit:postReply,className:"reply-area-container",children:[pendingAttachments.length>0&&(0,jsx_runtime.jsx)(ReplyAttachmentList.A,{files:pendingAttachments,isEditing:!0,fileDeleted:file=>deleteAttachment(annotation.Id,file)}),(0,jsx_runtime.jsxs)("div",{className:"reply-area-with-button",children:[(0,jsx_runtime.jsx)("div",{className:replyAreaClass,onMouseDown:e=>e.stopPropagation(),children:(0,jsx_runtime.jsx)(NoteTextarea.A,{ref:el=>{textareaRef.current=el},value:pendingReplyMap[annotation.Id],onChange:value=>(value=>{setPendingReply(value,annotation.Id),onPendingReplyChange&&onPendingReplyChange()})(value),onSubmit:postReply,onBlur:()=>{setIsFocused(!1),setCurAnnotId(void 0)},onFocus:()=>{setIsFocused(!0),setCurAnnotId(annotation.Id)},isReply:!0})}),(0,jsx_runtime.jsx)("div",{className:"reply-button-container",children:(0,jsx_runtime.jsx)(Button.A,{img:"icon-post-reply",className:"reply-button",title:"action.submit",disabled:!pendingReplyMap[annotation.Id],onClick:postReply,isSubmitType:!0})})]})]})};ReplyArea_ReplyArea.propTypes=propTypes;const Note_ReplyArea_ReplyArea=ReplyArea_ReplyArea;ReplyArea_ReplyArea.__docgenInfo={description:"",methods:[],displayName:"ReplyArea",props:{annotation:{description:"",type:{name:"object"},required:!0}}};const Note_ReplyArea=Note_ReplyArea_ReplyArea,NoteGroupSection_propTypes={groupAnnotations:prop_types_default().array.isRequired,isMultiSelectMode:prop_types_default().bool.isRequired},NoteGroupSection=({groupAnnotations,isMultiSelectMode})=>{const[t]=(0,useTranslation.B)(),dispatch=(0,es.wA)(),[isViewingGroupAnnots,setIsViewingGroupAnnots]=(0,react.useState)(!1),customizableUI=(0,es.d4)((state=>selectors.A.getFeatureFlags(state)?.customizableUI)),ViewAllAnnotsButton=(0,jsx_runtime.jsx)(Button.A,{onClick:e=>{e.preventDefault(),e.stopPropagation(),setIsViewingGroupAnnots(!0)},className:"text-button",ariaLabel:t("component.noteGroupSection.open"),label:t("component.noteGroupSection.open"),img:"ic_chevron_down_black_24px"}),CloseAllAnnotsButton=(0,jsx_runtime.jsx)(Button.A,{onClick:e=>{e.preventDefault(),e.stopPropagation(),setIsViewingGroupAnnots(!1)},className:"text-button",ariaLabel:t("component.noteGroupSection.close"),label:t("component.noteGroupSection.close"),img:"ic_chevron_up_black_24px"});return(0,jsx_runtime.jsxs)("div",{className:classnames_default()({"group-section":!0,"modular-ui":customizableUI}),children:[isViewingGroupAnnots?CloseAllAnnotsButton:ViewAllAnnotsButton,isViewingGroupAnnots&&groupAnnotations.map(((groupAnnotation,i)=>0===i?null:(0,jsx_runtime.jsx)(Button.A,{className:"group-child",onClick:e=>{e.preventDefault(),e.stopPropagation(),core.A.selectAnnotation(groupAnnotation),core.A.jumpToAnnotation(groupAnnotation),dispatch(actions.A.openElement("annotationPopup"))},children:(0,jsx_runtime.jsx)(components_NoteContent,{annotation:groupAnnotation,isUnread:!1,isGroupMember:!0,isMultiSelectMode},groupAnnotation.Id)},groupAnnotation.Id)))]})};NoteGroupSection.propTypes=NoteGroupSection_propTypes;const Note_NoteGroupSection=NoteGroupSection;NoteGroupSection.__docgenInfo={description:"",methods:[],displayName:"NoteGroupSection",props:{groupAnnotations:{description:"",type:{name:"array"},required:!0},isMultiSelectMode:{description:"",type:{name:"bool"},required:!0}}};var react_dom=__webpack_require__("./node_modules/react-dom/index.js"),panel=__webpack_require__("./src/constants/panel.js"),getPopupPosition=__webpack_require__("./src/helpers/getPopupPosition.js"),getRootNode=__webpack_require__("./src/helpers/getRootNode.js");__webpack_require__("./src/components/AnnotationNoteConnectorLine/AnnotationNoteConnectorLine.scss");const LineConnectorPortal=({children})=>{const mount=(0,getRootNode.Ay)().querySelector("#line-connector-root"),el=document.createElement("div");return el.setAttribute("data-element",dataElement.A.ANNOTATION_NOTE_CONNECTOR_LINE),(0,react.useEffect)((()=>(mount.appendChild(el),()=>mount.removeChild(el))),[el,mount]),(0,react_dom.createPortal)(children,el)},AnnotationNoteConnectorLine_propTypes={annotation:prop_types_default().object,noteContainerRef:prop_types_default().object,isCustomPanelOpen:prop_types_default().bool},AnnotationNoteConnectorLine_AnnotationNoteConnectorLine=({annotation,noteContainerRef,isCustomPanelOpen})=>{const[isCustomUIEnabled,topHeadersHeight,bottomHeadersHeight,notePanelWidth,lineIsOpen,notePanelIsOpen,isLineDisabled,documentContainerWidth,documentContainerHeight,activeDocumentViewerKey]=(0,es.d4)((state=>[selectors.A.getIsCustomUIEnabled(state),selectors.A.getTopHeadersHeight(state),selectors.A.getBottomHeadersHeight(state),selectors.A.getNotesPanelWidth(state),selectors.A.isElementOpen(state,dataElement.A.ANNOTATION_NOTE_CONNECTOR_LINE),selectors.A.isElementOpen(state,dataElement.A.NOTES_PANEL),selectors.A.isElementDisabled(state,dataElement.A.ANNOTATION_NOTE_CONNECTOR_LINE),selectors.A.getDocumentContainerWidth(state),selectors.A.getDocumentContainerHeight(state),selectors.A.getActiveDocumentViewerKey(state)]),es.bN),dispatch=(0,es.wA)(),[rightHorizontalLineWidth,setRightHorizontalLineWidth]=(0,react.useState)(0),[rightHorizontalLineTop,setRightHorizontalLineTop]=(0,react.useState)(0),[rightHorizontalLineRight,setRightHorizontalLineRight]=(0,react.useState)(0),[leftHorizontalLineWidth,setLeftHorizontalLineWidth]=(0,react.useState)(0),[leftHorizontalLineTop,setLeftHorizontalLineTop]=(0,react.useState)(0),[leftHorizontalLineRight,setLeftHorizontalLineRight]=(0,react.useState)(0),notesPanelResizeBarWidth=isCustomUIEnabled?panel.Yj:0,{bottomRight:annotationBottomRight,topLeft:annotationTopLeft}=(0,getPopupPosition.Ze)(annotation,activeDocumentViewerKey),getAnnotationLineOffset=(0,react.useCallback)((()=>"Note"===annotation.Subject?4:15),[annotation]);if((0,react.useEffect)((()=>{const onPageNumberUpdated=()=>{dispatch(actions.A.closeElement(dataElement.A.ANNOTATION_NOTE_CONNECTOR_LINE))};return core.A.addEventListener("pageNumberUpdated",onPageNumberUpdated,void 0,activeDocumentViewerKey),()=>{core.A.removeEventListener("pageNumberUpdated",onPageNumberUpdated,activeDocumentViewerKey)}}),[]),(0,react.useEffect)((()=>{if(!noteContainerRef||!noteContainerRef.current)return;const{scrollTop,scrollLeft}=core.A.getScrollViewElement(activeDocumentViewerKey);if(!(annotationBottomRight&&annotationTopLeft))return()=>{dispatch(actions.A.closeElement(dataElement.A.ANNOTATION_NOTE_CONNECTOR_LINE))};const isWebComponent=window.isApryseWebViewerWebComponent,annotationWidth=annotationBottomRight.x-annotationTopLeft.x,distanceToAnnotation=(({viewerWidth,annotationXPosition,annotationWidth,notePanelWidth,notePanelPadding,notesPanelResizeBarWidth,scrollLeft})=>viewerWidth-annotationXPosition-annotationWidth-notePanelWidth+notePanelPadding+notesPanelResizeBarWidth+scrollLeft)({viewerWidth:window.isApryseWebViewerWebComponent?(0,getRootNode.Ay)().host.clientWidth:window.innerWidth,annotationXPosition:annotationTopLeft.x,annotationWidth,notePanelWidth,notePanelPadding:16,notesPanelResizeBarWidth,scrollLeft}),{rightHorizontalLineRightOffset,rightHorizontalLineTopOffset,rightHorizontalLineLength}=(({notePanelWidth,notePanelPadding,notesPanelResizeBarWidth,notesContainerTop,viewerOffsetTop,distanceToAnnotation,lineWidthRatio=.75})=>({rightHorizontalLineRightOffset:notePanelWidth-notePanelPadding-notesPanelResizeBarWidth,rightHorizontalLineTopOffset:notesContainerTop-viewerOffsetTop,rightHorizontalLineLength:distanceToAnnotation*lineWidthRatio}))({notePanelWidth,notePanelPadding:16,notesPanelResizeBarWidth,notesContainerTop:noteContainerRef.current.getBoundingClientRect().top,viewerOffsetTop:isWebComponent?(0,getRootNode.Ay)().host.offsetTop:0,distanceToAnnotation,lineWidthRatio:.75});setRightHorizontalLineRight(rightHorizontalLineRightOffset),setRightHorizontalLineTop(rightHorizontalLineTopOffset),setRightHorizontalLineWidth(rightHorizontalLineLength);const{leftHorizontalLineRightOffset,leftHorizontalLineTopOffset,leftHorizontalLineLength}=(({isAnnotationNoZoom,annotationNoZoomReferencePoint,annotationHeight,notePanelWidth,notePanelPadding,notesPanelResizeBarWidth,rightHorizontalLineLength,distanceToAnnotation,annotationTopLeftY,scrollTop,annotationLineOffset})=>{const noZoomRefShiftX=isAnnotationNoZoom&&annotationNoZoomReferencePoint.x?annotationNoZoomReferencePoint.x*annotationHeight:0;return{leftHorizontalLineRightOffset:notePanelWidth-notePanelPadding-notesPanelResizeBarWidth+rightHorizontalLineLength,leftHorizontalLineTopOffset:annotationTopLeftY+annotationHeight/2-scrollTop-(isAnnotationNoZoom&&annotationNoZoomReferencePoint.y?annotationNoZoomReferencePoint.y*annotationHeight:0),leftHorizontalLineLength:distanceToAnnotation-rightHorizontalLineLength-annotationLineOffset+noZoomRefShiftX}})({isAnnotationNoZoom:annotation.NoZoom,annotationNoZoomReferencePoint:annotation.getNoZoomReferencePoint(),annotationHeight:annotationBottomRight.y-annotationTopLeft.y,notePanelWidth,notePanelPadding:16,notesPanelResizeBarWidth,rightHorizontalLineLength,distanceToAnnotation,annotationTopLeftY:annotationTopLeft.y,scrollTop,annotationLineOffset:getAnnotationLineOffset()});setLeftHorizontalLineRight(leftHorizontalLineRightOffset),setLeftHorizontalLineTop(leftHorizontalLineTopOffset),setLeftHorizontalLineWidth(leftHorizontalLineLength)}),[noteContainerRef,notePanelWidth,annotationBottomRight,annotationTopLeft,documentContainerWidth,documentContainerHeight]),(0,react.useEffect)((()=>{const onPageNumberUpdated=()=>{dispatch(actions.A.closeElement(dataElement.A.ANNOTATION_NOTE_CONNECTOR_LINE))};return core.A.addEventListener("pageNumberUpdated",onPageNumberUpdated,void 0,activeDocumentViewerKey),()=>{core.A.removeEventListener("pageNumberUpdated",onPageNumberUpdated,activeDocumentViewerKey)}}),[dispatch,activeDocumentViewerKey]),lineIsOpen&&(notePanelIsOpen||isCustomPanelOpen)&&!isLineDisabled){const{verticalLineTop,verticalLineHeight,isAnnotationOffScreen}=(({rightHorizontalLineTop,leftHorizontalLineTop,bottomHeaderTop,topHeadersHeight,isCustomUIEnabled})=>{let verticalLineTop=rightHorizontalLineTop>leftHorizontalLineTop?leftHorizontalLineTop+2:rightHorizontalLineTop,verticalLineHeight=Math.abs(rightHorizontalLineTop-leftHorizontalLineTop);const isAnnotationAboveViewer=verticalLineTop<topHeadersHeight,isAnnotationBelow=verticalLineTop+verticalLineHeight>bottomHeaderTop,isAnnotationOffScreen=isAnnotationAboveViewer||isAnnotationBelow;return isAnnotationOffScreen&&isCustomUIEnabled&&(isAnnotationAboveViewer?(verticalLineHeight=Math.abs(rightHorizontalLineTop-topHeadersHeight)+2,verticalLineTop=topHeadersHeight):isAnnotationBelow&&(verticalLineHeight=Math.abs(bottomHeaderTop-rightHorizontalLineTop))),{verticalLineTop,verticalLineHeight,isAnnotationOffScreen}})({rightHorizontalLineTop,leftHorizontalLineTop,bottomHeaderTop:(window.isApryseWebViewerWebComponent?(0,getRootNode.Ay)().host.clientHeight:window.innerWidth)-bottomHeadersHeight,topHeadersHeight,isCustomUIEnabled});return(0,jsx_runtime.jsxs)(LineConnectorPortal,{children:[(0,jsx_runtime.jsx)("div",{className:"horizontalLine",style:{width:rightHorizontalLineWidth,right:rightHorizontalLineRight,top:rightHorizontalLineTop}}),(0,jsx_runtime.jsx)("div",{className:"verticalLine",style:{height:verticalLineHeight,top:verticalLineTop,right:rightHorizontalLineRight+rightHorizontalLineWidth}}),(0,jsx_runtime.jsx)("div",{className:"horizontalLine",style:{width:leftHorizontalLineWidth,right:leftHorizontalLineRight,top:leftHorizontalLineTop,visibility:isAnnotationOffScreen?"hidden":"visible"},children:(0,jsx_runtime.jsx)("div",{className:"arrowHead"})})]})}return null};AnnotationNoteConnectorLine_AnnotationNoteConnectorLine.propTypes=AnnotationNoteConnectorLine_propTypes;const components_AnnotationNoteConnectorLine_AnnotationNoteConnectorLine=AnnotationNoteConnectorLine_AnnotationNoteConnectorLine;AnnotationNoteConnectorLine_AnnotationNoteConnectorLine.__docgenInfo={description:"",methods:[],displayName:"AnnotationNoteConnectorLine",props:{annotation:{description:"",type:{name:"object"},required:!1},noteContainerRef:{description:"",type:{name:"object"},required:!1},isCustomPanelOpen:{description:"",type:{name:"bool"},required:!1}}};const components_AnnotationNoteConnectorLine=components_AnnotationNoteConnectorLine_AnnotationNoteConnectorLine;var map=__webpack_require__("./src/constants/map.js"),officeEditor=__webpack_require__("./src/constants/officeEditor.js"),isAnnotationRenderedInDisplayMode=(__webpack_require__("./src/components/Note/Note.scss"),__webpack_require__("./src/helpers/isAnnotationRenderedInDisplayMode.js"));const Note_propTypes={annotation:prop_types_default().object.isRequired,isMultiSelected:prop_types_default().bool,isMultiSelectMode:prop_types_default().bool,isInNotesPanel:prop_types_default().bool,handleMultiSelect:prop_types_default().func};let currId=0;const Note_Note=({annotation,isMultiSelected,isMultiSelectMode,isInNotesPanel,handleMultiSelect,isCustomPanelOpen,shouldHideConnectorLine})=>{const{isSelected,resize,pendingEditTextMap,isContentEditable,isDocumentReadOnly,isExpandedFromSearch,setCurAnnotId}=(0,react.useContext)(Context.A),containerRef=(0,react.useRef)(),containerHeightRef=(0,react.useRef)(),[isEditingMap,setIsEditingMap]=(0,react.useState)({}),ids=(0,react.useRef)([]),dispatch=(0,es.wA)(),[t]=(0,useTranslation.B)(),unreadReplyIdSet=new Set,[noteTransformFunction,customNoteSelectionFunction,unreadAnnotationIdSet,shouldExpandCommentThread,isRightClickAnnotationPopupEnabled,documentViewerKey,isOfficeEditorMode,officeEditorEditMode]=(0,es.d4)((state=>[selectors.A.getNoteTransformFunction(state),selectors.A.getCustomNoteSelectionFunction(state),selectors.A.getUnreadAnnotationIdSet(state),selectors.A.isCommentThreadExpansionEnabled(state),selectors.A.isRightClickAnnotationPopupEnabled(state),selectors.A.getActiveDocumentViewerKey(state),selectors.A.getIsOfficeEditorMode(state),selectors.A.getOfficeEditorEditMode(state)]),es.bN),setIsEditing=(0,react.useCallback)(((isEditing,index)=>{setIsEditingMap((map=>({...map,[index]:isEditing})))}),[setIsEditingMap]),replies=annotation.getReplies().sort(((a,b)=>a.DateCreated-b.DateCreated));replies.filter((r=>unreadAnnotationIdSet.has(r.Id))).forEach((r=>unreadReplyIdSet.add(r.Id))),(0,react.useEffect)((()=>{const annotationChangedListener=(annotations,action)=>{"delete"===action&&annotations.forEach((annot=>{unreadAnnotationIdSet.has(annot.Id)&&dispatch(actions.A.setAnnotationReadState({isRead:!0,annotationId:annot.Id}))}))};return core.A.addEventListener("annotationChanged",annotationChangedListener,void 0,documentViewerKey),()=>{core.A.removeEventListener("annotationChanged",annotationChangedListener,documentViewerKey)}}),[unreadAnnotationIdSet]),(0,react.useEffect)((()=>{const prevHeight=containerHeightRef.current,currHeight=containerRef.current.getBoundingClientRect().height;containerHeightRef.current=currHeight,prevHeight&&Math.round(prevHeight)!==Math.round(currHeight)&&resize()})),(0,react.useEffect)((()=>{if(noteTransformFunction){const notesPanelElement=(0,getRootNode.Ay)().querySelectorAll(".NotesPanel")[0];ids.current.forEach((id=>{const child=notesPanelElement.querySelector(`[data-webviewer-custom-element=${id}]`);child&&child.parentNode.removeChild(child)})),ids.current=[];const state={annotation,isSelected};noteTransformFunction(containerRef.current,state,((...params)=>{const element=document.createElement(...params),id=`custom-element-${currId}`;return currId++,ids.current.push(id),element.setAttribute("data-webviewer-custom-element",id),element.addEventListener("mousedown",(e=>{e.stopPropagation()})),element}))}})),(0,react.useEffect)((()=>{""!==pendingEditTextMap[annotation.Id]&&isContentEditable&&!isDocumentReadOnly&&setIsEditing(!0,0)}),[isDocumentReadOnly,isContentEditable,setIsEditing,annotation,isMultiSelectMode]),(0,useDidUpdate.A)((()=>{!isDocumentReadOnly&&isContentEditable||setIsEditing(!1,0)}),[isDocumentReadOnly,isContentEditable,setIsEditing]);const handleNoteClick=async e=>{if(e&&e.stopPropagation(),isMultiSelectMode)handleMultiSelect(!isMultiSelected);else if(unreadAnnotationIdSet.has(annotation.Id)&&dispatch(actions.A.setAnnotationReadState({isRead:!0,annotationId:annotation.Id})),customNoteSelectionFunction&&customNoteSelectionFunction(annotation),isSelected||(core.A.deselectAllAnnotations(documentViewerKey),setTimeout((()=>dispatch(actions.A.openElement(dataElement.A.ANNOTATION_NOTE_CONNECTOR_LINE))),300)),isInNotesPanel&&(!isOfficeEditorMode||officeEditorEditMode!==officeEditor.r8.PREVIEW)&&(core.A.selectAnnotation(annotation,documentViewerKey),setCurAnnotId(annotation.Id),core.A.jumpToAnnotation(annotation,documentViewerKey),isRightClickAnnotationPopupEnabled||dispatch(actions.A.openElement(dataElement.A.ANNOTATION_POPUP)),isOfficeEditorMode)){const trackedChangeId=annotation.getCustomData(officeEditor.Rf);await core.A.getOfficeEditor().moveCursorToTrackedChange(trackedChangeId),core.A.getOfficeEditor().freezeMainCursor()}},hasUnreadReplies=unreadReplyIdSet.size>0,noteClass=classnames_default()({Note:!0,expanded:isSelected,"is-multi-selected":isMultiSelected,unread:unreadAnnotationIdSet.has(annotation.Id)||hasUnreadReplies,disabled:isOfficeEditorMode&&officeEditorEditMode===officeEditor.r8.PREVIEW}),repliesClass=classnames_default()({replies:!0,hidden:!isSelected});(0,react.useEffect)((()=>{isMultiSelectMode||replies.forEach(((reply,index)=>{const pendingText=pendingEditTextMap[reply.Id];""!==pendingText&&void 0!==pendingText&&isSelected&&setIsEditing(!0,1+index)}))}),[isSelected,isMultiSelectMode]),(0,react.useEffect)((()=>{isMultiSelectMode&&setIsEditing(!1,0)}),[isMultiSelectMode]);const showReplyArea=!Object.values(isEditingMap).some((val=>val)),handleReplyClicked=reply=>{unreadReplyIdSet.has(reply.Id)&&(dispatch(actions.A.setAnnotationReadState({isRead:!0,annotationId:reply.Id})),core.A.getAnnotationManager(documentViewerKey).selectAnnotation(reply))},markAllRepliesRead=()=>{if(unreadReplyIdSet.size>0){const repliesSetToRead=replies.filter((r=>unreadReplyIdSet.has(r.Id)));core.A.getAnnotationManager(documentViewerKey).selectAnnotations(repliesSetToRead),repliesSetToRead.forEach((r=>dispatch(actions.A.setAnnotationReadState({isRead:!0,annotationId:r.Id}))))}},groupAnnotations=core.A.getGroupAnnotations(annotation,documentViewerKey),isGroup=groupAnnotations.length>1,isTrackedChange=(0,map.c7)(annotation)===map.oC.TRACKED_CHANGE,lastReplyId=replies.length>0?replies[replies.length-1].Id:null,isRenderableInCurrentDisplayMode=(0,isAnnotationRenderedInDisplayMode.H)(core.A,annotation),isRenderingConnectorLine=isSelected&&(isInNotesPanel||isCustomPanelOpen)&&!shouldHideConnectorLine&&isRenderableInCurrentDisplayMode;return(0,jsx_runtime.jsxs)("div",{ref:containerRef,className:noteClass,id:`note_${annotation.Id}`,children:[(0,jsx_runtime.jsx)(Button.A,{className:"note-button",onClick:e=>handleNoteClick(e),ariaLabelledby:`note_${annotation.Id}`,ariaCurrent:isSelected,dataElement:"expandNoteButton"}),(0,jsx_runtime.jsx)(components_NoteContent,{noteIndex:0,annotation,setIsEditing,handleNoteClick,isEditing:isEditingMap[0],isNonReplyNoteRead:!unreadAnnotationIdSet.has(annotation.Id),isUnread:unreadAnnotationIdSet.has(annotation.Id)||hasUnreadReplies,handleMultiSelect:e=>{setCurAnnotId(annotation.Id),handleMultiSelect(e)},isMultiSelected,isMultiSelectMode}),(isSelected||isExpandedFromSearch||shouldExpandCommentThread)&&!isTrackedChange&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[replies.length>0&&(0,jsx_runtime.jsxs)("div",{className:repliesClass,children:[hasUnreadReplies&&(0,jsx_runtime.jsx)(Button.A,{dataElement:"markAllReadButton",className:"mark-all-read-button",label:t("action.markAllRead"),onClick:markAllRepliesRead}),replies.map(((reply,i)=>(0,jsx_runtime.jsx)("div",{className:"reply",id:`note_reply_${reply.Id}`,children:(0,jsx_runtime.jsx)(components_NoteContent,{noteIndex:i+1,annotation:reply,setIsEditing,isEditing:isEditingMap[i+1],onReplyClicked:handleReplyClicked,isUnread:unreadAnnotationIdSet.has(reply.Id),handleMultiSelect,isMultiSelected,isMultiSelectMode,handleNoteClick},reply.Id)},`note_reply_${reply.Id}`)))]}),isGroup&&(0,jsx_runtime.jsx)(Note_NoteGroupSection,{groupAnnotations,isMultiSelectMode}),showReplyArea&&!isMultiSelectMode&&(0,jsx_runtime.jsx)(Note_ReplyArea,{isUnread:lastReplyId&&unreadAnnotationIdSet.has(lastReplyId),onPendingReplyChange:markAllRepliesRead,annotation})]}),isRenderingConnectorLine&&(0,jsx_runtime.jsx)(components_AnnotationNoteConnectorLine,{annotation,noteContainerRef:containerRef,isCustomPanelOpen})]})};Note_Note.propTypes=Note_propTypes;const components_Note_Note=Note_Note;Note_Note.__docgenInfo={description:"",methods:[],displayName:"Note",props:{annotation:{description:"",type:{name:"object"},required:!0},isMultiSelected:{description:"",type:{name:"bool"},required:!1},isMultiSelectMode:{description:"",type:{name:"bool"},required:!1},isInNotesPanel:{description:"",type:{name:"bool"},required:!1},handleMultiSelect:{description:"",type:{name:"func"},required:!1}}};const components_Note=components_Note_Note},"./src/components/NotesPanel/ReplyAttachmentPicker.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/jsx-runtime.js"),react_redux__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/react-redux/es/index.js")),selectors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/redux/selectors/index.js");const ReplyAttachmentPicker=({annotationId,addAttachments})=>{const replyAttachmentHandler=(0,react_redux__WEBPACK_IMPORTED_MODULE_2__.d4)((state=>selectors__WEBPACK_IMPORTED_MODULE_3__.A.getReplyAttachmentHandler(state)));return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("input",{id:"reply-attachment-picker",type:"file",style:{display:"none"},onChange:async e=>{const file=e.target.files[0];if(file){let attachment=file;if(replyAttachmentHandler){attachment={url:await replyAttachmentHandler(file),name:file.name,size:file.size,type:file.type}}addAttachments(annotationId,[attachment])}},onClick:e=>{e.target.value=""}})},__WEBPACK_DEFAULT_EXPORT__=ReplyAttachmentPicker;ReplyAttachmentPicker.__docgenInfo={description:"",methods:[],displayName:"ReplyAttachmentPicker"}},"./src/helpers/isAnnotationRenderedInDisplayMode.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{H:()=>isAnnotationRenderedInDisplayMode});const isAnnotationRenderedInDisplayMode=(core,annotation)=>{const isAnnotationInVisiblePages=core.getDisplayModeObject().getVisiblePages().includes(annotation.PageNumber);return core.isContinuousDisplayMode()||!core.isContinuousDisplayMode()&&isAnnotationInVisiblePages}}}]);